<header class="site-header mo-left header style-1">
  <!-- Main Header -->
  <div class="header-info-bar">
    <div class="container clearfix">
      <!-- Website Logo -->
      <div class="logo-header logo-dark">
        <a href="/"><img src="/images/logo.png" alt="logo"></a>
      </div>



      <!-- EXTRA NAV -->
      <div class="extra-nav">
        <div class="extra-cell">
          <ul class="navbar-nav header-right">

            <li class="nav-item">
              <button type="button" class="nav-link box cart-btn">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000">
                  <path d="M0 0h24v24H0V0z" fill="none" />
                  <path
                    d="M15.55 13c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.37-.66-.11-1.48-.87-1.48H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7l1.1-2h7.45zM6.16 6h12.15l-2.76 5H8.53L6.16 6zM7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
                </svg>
                <span class="badge" id="cart-number"></span>
              </button>
              <ul class="dropdown-menu cart-list" id="cart-list">
                <!-- <li class="cart-item">
                  <div class="media">
                    <div class="media-left">
                      <a href="books-detail.html">
                        <img alt="" class="media-object" src="images/books/small/pic1.jpg">
                      </a>
                    </div>
                    <div class="media-body">
                      <h6 class="dz-title"><a href="books-detail.html" class="media-heading">Real Life</a></h6>
                      <span class="dz-price">$28.00</span>
                      <span class="item-close">&times;</span>
                    </div>
                  </div>
                </li>
                <li class="cart-item">
                  <div class="media">
                    <div class="media-left">
                      <a href="books-detail.html">
                        <img alt="" class="media-object" src="images/books/small/pic2.jpg">
                      </a>
                    </div>
                    <div class="media-body">
                      <h6 class="dz-title"><a href="books-detail.html" class="media-heading">Home</a></h6>
                      <span class="dz-price">$28.00</span>
                      <span class="item-close">&times;</span>
                    </div>
                  </div>
                </li>
                <li class="cart-item">
                  <div class="media">
                    <div class="media-left">
                      <a href="books-detail.html">
                        <img alt="" class="media-object" src="images/books/small/pic3.jpg">
                      </a>
                    </div>
                    <div class="media-body">
                      <h6 class="dz-title"><a href="books-detail.html" class="media-heading">Such a fun age</a></h6>
                      <span class="dz-price">$28.00</span>
                      <span class="item-close">&times;</span>
                    </div>
                  </div>
                </li> -->

              </ul>
            </li>

            <li class="nav-item dropdown profile-dropdown  ms-4">

              <!-- User authenticated -->
              <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                <div class="my-custom-avatar small">
                  <%= avatarByName(user?.fullName || 'GUEST' ) %>
                </div>
                <div class="profile-info">
                  <h6 class="title">
                    <%= user?.fullName || 'GUEST' %>
                  </h6>
                  <span>
                    <%= user?.email || 'Email' %>
                  </span>
                </div>
              </a>
              <div class="dropdown-menu py-0 dropdown-menu-end">
                <div class="dropdown-header">
                  <h6 class="m-0">
                    <%= user?.fullName || 'GUEST' %>
                  </h6>
                  <span>
                    <%= user?.email || 'Email' %>
                  </span>
                </div>
                <div class="dropdown-body">
                  <a href="/user/profile"
                    class="dropdown-item d-flex justify-content-between align-items-center ai-icon">
                    <div>
                      <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"
                        fill="#000000">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path
                          d="M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c2.7 0 5.8 1.29 6 2H6c.23-.72 3.31-2 6-2m0-12C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 10c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                      </svg>
                      <span class="ms-2">Profile</span>
                    </div>
                  </a>
                  <a href="shop-cart.html"
                    class="dropdown-item d-flex justify-content-between align-items-center ai-icon">
                    <div>
                      <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"
                        fill="#000000">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path
                          d="M15.55 13c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.37-.66-.11-1.48-.87-1.48H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7l1.1-2h7.45zM6.16 6h12.15l-2.76 5H8.53L6.16 6zM7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
                      </svg>
                      <span class="ms-2">My Order</span>
                    </div>
                  </a>
                  <a href="wishlist.html"
                    class="dropdown-item d-flex justify-content-between align-items-center ai-icon">
                    <div>
                      <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"
                        fill="#000000">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path
                          d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z" />
                      </svg>
                      <span class="ms-2">Wishlist</span>
                    </div>
                  </a>
                </div>
                <div class="dropdown-footer">
                  <% if (user){%>
                    <a class="btn btn-primary w-100 btnhover btn-sm" href="/auth/logout">Log Out</a>
                    <% } else { %>
                      <a class="btn btn-primary w-100 btnhover btn-sm" href="/auth/login">Log In</a>
                      <% } %>
                </div>
              </div>
              <!-- End User Authenticated -->
            </li>


          </ul>
        </div>
      </div>

      <!-- header search nav -->
      <div class="header-search-nav">
        <form class="header-item-search">
          <div class="input-group search-input">
            <input type="text" id="search-bar" class="form-control search-bar"
              aria-label="Text input with dropdown button" placeholder="Search Books Here">
            <span id="search-result"></span>
            <button class="btn" type="button"><i class="fa-solid fa-magnifying-glass"></i></button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- Main Header End -->

  <!-- Main Header -->
  <div class="sticky-header main-bar-wraper navbar-expand-lg">
    <div class="main-bar clearfix">
      <div class="container clearfix">
        <!-- Website Logo display in mobile mode -->
        <div class="logo-header logo-dark">
          <a href="index.html"><img src="http://localhost:3003/images/logo.png" alt="logo"></a>
        </div>

        <!-- Nav Toggle Button display in mobile mode -->
        <button class="navbar-toggler collapsed navicon justify-content-end" type="button" data-bs-toggle="collapse"
          data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false"
          aria-label="Toggle navigation">
          <span></span>
          <span></span>
          <span></span>
        </button>

        <!-- EXTRA NAV -->
        <div class="extra-nav">
          <div class="extra-cell">
            <a href="contact-us.html" class="btn btn-primary btnhover">Get In Touch</a>
          </div>
        </div>

        <!-- Main Nav -->
        <div class="header-nav navbar-collapse collapse justify-content-start" id="navbarNavDropdown">
          <div class="logo-header logo-dark">
            <a href="/"><img src="images/logo.png" alt=""></a>
          </div>
          <form class="search-input">
            <div class="input-group">
              <input type="text" class="form-control" aria-label="Text input with dropdown button"
                placeholder="Search Books Here">
              <button class="btn" type="button"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
          </form>
          <ul class="nav navbar-nav">
            <li>
              <a href="/"><span>Home</span></a>
            </li>
            <li>
              <a href="#"><span>About Us</span></a>
            </li>

            <!-- Menu for authenticated user -->
            <li>
              <a href="/user/profile"><span>My profile</span></a>
            </li>

            <!-- Menu for unauthenticated user-->
            <li class="sub-menu-down"><a href="javascript:void(0);"><span>Account</span></a>
              <ul class="sub-menu">
                <li><a href="/auth/login">Log in</a></li>
                <li><a href="/auth/register">Register account</a></li>
              </ul>
            </li>

            <li class="sub-menu-down"><a href="javascript:void(0);"><span>Category</span></a>
              <ul class="sub-menu" id="category-list">
              </ul>
            </li>

            <li><a href="#"><span>Contact Us</span></a></li>
          </ul>
          <div class="dz-social-icon">
            <ul>
              <li><a class="fab fa-facebook-f" target="_blank" href="https://www.facebook.com/dexignzone"></a></li>
              <li><a class="fab fa-twitter" target="_blank" href="https://twitter.com/dexignzones"></a></li>
              <li><a class="fab fa-linkedin-in" target="_blank"
                  href="https://www.linkedin.com/showcase/3686700/admin/"></a></li>
              <li><a class="fab fa-instagram" target="_blank" href="https://www.instagram.com/website_templates__/"></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Main Header End -->

</header>
<script>
  var searchData = document.getElementById('search-bar');
  var searchResult = document.getElementById('search-result');
  console.log('Check searchData: ', searchData);

  function load_data(data) {
    var html = '<ul class="list-group">';
    if (data && data.books.length > 0) {
      html += '<li class="list-group-item list-group-item-action disabled">Books</li>'
      for (const book of data.books) {
        html += `<a href="/book/${book.id}" class="list-group-item list-group-item-action custom-search-item" onclick="get_text(this)">${book.name}</a>`
      }
    }
    if (data && data.categories.length > 0) {
      html += '<li class="list-group-item list-group-item-action disabled">Categories</li>'
      for (const cateogory of data.categories) {
        html += `<a href="/books?categoryId=${cateogory.id}" class="list-group-item list-group-item-action custom-search-item" onclick="get_text(this)">${cateogory.name}</a>`
      }
    }
    if (data && data.authors.length > 0) {
      html += '<li class="list-group-item list-group-item-action disabled">Authors</li>'
      for (const author of data.authors) {
        html += `<a href="/books/?authorId=${author.id}" class="list-group-item list-group-item-action custom-search-item" onclick="get_text(this)">${author.name}</a>`
      }
    }
    if (data && data.publishers.length > 0) {
      html += '<li class="list-group-item list-group-item-action disabled">Publishers</li>'
      for (const publisher of data.publishers) {
        html += `<a href="/books/?publisherId=${publisher.id}" class="list-group-item list-group-item-action custom-search-item" onclick="get_text(this)">${publisher.name}</a>`
      }
    }
    if (data.books.length < 1 && data.categories.length < 1 && data.authors.length < 1) {
      html += '<div class="list-group-item list-group-item-action disabled">No Data Found</div>';
    }

    html += '</ul>';

    searchResult.innerHTML = html;
  }

  searchData.onkeyup = function () {
    console.log('Search data: ', searchData.value);
    if (searchData.value.length === 0) {
      searchResult.style.display = "none";
    } else {
      searchResult.style.display = "block";

      $.ajax({
        type: "GET",
        url: "/book/get_search_data",
        data: "search_query=" + searchData.value,    // multiple data sent using ajax
        success: function (data) {
          load_data(data);
        }
      });
    }
  }
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const categoryList = $('#category-list')
    const cart = $('#cart-list')
    fetch('/category')
      .then(response => response.json())
      .then(data => {
        const list = data.categories.map(category => `
          <li><a href="/category/${category.id}">${category.name}</a></li>
          `).join('')
        categoryList.append(list)
      })
      .catch(err => console.log(err))

    fetch('/cart/simple')
      .then(response => response.json())
      .then(data => {
        const list = data.map(item => {
          return (`
          <li class="cart-item">
            <div class="media">
              <div class="media-left">
                <a href="/book/${item.book.id} ">
                  <img alt="" class="media-object" src="/${item.book.images[0].path}">
                </a>
              </div>
              <div class="media-body">
                <h6 class="dz-title"><a href="books-detail.html" class="media-heading">${item.book.name}</a></h6>
                <span class="dz-price">${item.book.price} VND</span> x
                <span class="dz-quantity">${item.quantity}</span>
                <span data-id="${item.id}" class="item-close delete-cart-item">&times;</span>
              </div>
            </div>
          </li>
            `)
        })
        cart.append(list)
        cart.append(`
        <li class="cart-item text-center">
          <h6 class="text-secondary">Total = ${data.reduce((sum, item) => sum += item.book.price * item.quantity, 0)} VND</h6>
        </li>
        <li class="text-center d-flex">
          <a href="/cart" class="btn btn-sm btn-primary me-2 btnhover w-100">View Cart</a>
          <a href="/cart/checkout" class="btn btn-sm btn-outline-primary btnhover w-100">Checkout</a>
        </li>
        `)
        $('#cart-number').html(data.length)

        const deleteCartItemBtns = document.querySelectorAll('.delete-cart-item')
        deleteCartItemBtns.forEach(btn => {
          btn.addEventListener('click', (e) => {
            console.log('hi')
            $.ajax({
              url: `/cart?id=${e.target.dataset.id}`,
              method: 'DELETE',
              success: () => {
                window.location.reload()
              }
            })
          })
        })
      })

  })
</script>


<!-- ================= -->
<!--
<nav class="navbar navbar-expand-lg navbar-dark bg-dark position-fixed custom-navbar">
  <div class="container">
    <a class="navbar-brand link-light" href="/">DD Courses</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle link-light" href="#" id="navbarDropdown" role="button"
            data-bs-toggle="dropdown" aria-expanded="false">
            <% if (locals.image) { %>
              <img src="<%= locals.image %>" alt="avatar" class="user-avatar" />
              <% } else { %>
                <img src="https://cdn-icons-png.flaticon.com/512/147/147142.png" alt="avatar" class="user-avatar" />
                <% } %>
                  <span id="header__user-name">
                    <%=locals.username %>
                  </span>

          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
            <% if (locals.username){ %>
              <li>
                <form action="/auth/logout?_method=DELETE" method="POST">
                  <button type="submit" class="logout-btn">Logout</button>
                </form>
              </li>

              <li>
                <hr class="dropdown-divider" />
              </li>

              <li><a class="dropdown-item" href="/courses/create">Đăng khóa học</a></li>

              <li>
                <hr class="dropdown-divider" />
              </li>

              <li>
                <a class="dropdown-item" href="/me/stored/courses">Khóa học của
                  tôi</a>
              </li>

              <li>
                <hr class="dropdown-divider" />
              </li>
              <li id="cart__link">
                <a class="dropdown-item" id="header__cart" href="/me/cart">Giỏ hàng</a>
                <div class="cart__minimized">
                  <ul class="cart__list">
              <% } %>
              <% if (!locals.username){ %>
                <li><a class="dropdown-item" href="/auth/login">Login</a></li>
              <% } %>
              <% if (locals.cartItems) { %>
                <% cartItems.forEach(item=> { %>
                  <li class="cart__item">
                    <img src="<%=item.image %>" alt="" class="cart__img">
                      <div class="cart__name">
                        <%=item.name %>
                      </div>
                      <span class="cart__count">
                        <%=item.count%>
                      </span>
                  </li>
                <% }) %>
              <% } %>
                  </ul>
                </div>
              </li>
          </ul>
        </li>
      </ul>

    </div>
  </div>
</nav>
-->